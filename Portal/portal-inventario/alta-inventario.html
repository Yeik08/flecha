<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario</title>
    <link rel="shortcut icon" href="../img/bus_8502475.png">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script> <!-- Agregado SheetJS para manejo de Excel -->
</head>

<body>
    <!-- Contenedor principal -->
    <div class="contenedor-principal">
        <div class="menu-superior">
            <!-- Opciones del menú -->
            <div class="opciones">
                <div class="fr">FLECHA ROJA</div>

                <ul class="menu">
                    <li><a href="../portal-camiones/camiones.html">Camiones</a></li>
                </ul>

                <ul class="menu">
                    <li><a href="#">Inventario</a></li>
                </ul>
                
                <ul class="menu">
                    <li><a href="../portal-personal/personal.html">Personal</a></li>
                </ul>
            </div>
        
            <div class="perfil">
                <a href="../index.html">
                    <img src="../img/cinta_principal2.png" class="img-perfil">
                </a>

                <a href="menu.html">
                    Yeykocf
                </a>

                <a href="../../php/logout.php"><button type="button">Cerrar sesión</button></a>
            </div>
        </div>
    </div>

    <!-- Body -->
    <main class="modulo-contenido">
        <div class="modulo-titulo">
            <h1>Gestión de Inventario de Filtros y Lubricantes</h1>
        </div>

        <div class="tarjetas">
            <div class="tarjeta">
                <h3>Total de Filtros</h3>
                <p>1,245</p>
            </div>
            <div class="tarjeta">
                <h3>Total de Lubricantes</h3>
                <p>200</p>
            </div>
            <div class="tarjeta alerta">
                <h3>Inventario Bajo</h3>
                <p>3</p>
            </div>
            <div class="tarjeta">
                <h3>Filtros Instalados</h3>
                <p>89</p>
            </div>
        </div>

        <div class="tabla-contenido">
            <div class="tabla-titulo">
                <h2>Filtros y Lubricantes Disponibles</h2>
                <button class="btn-primario" id="btn-agregar-inventario">+ Agregar Inventario</button>
            </div>
            
            <table>
                <!-- CABECERA DE TABLA -->
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tipo</th>
                        <th>Marca</th>
                        <th>Cantidad en Inventario</th>
                        <th>Ubicación</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <!-- CUERPO DE TABLA -->
                <tbody>
                    <tr>
                        <td>FR-ACE-001</td>
                        <td>Filtro de Aceite</td>
                        <td>PATITO1</td>
                        <td>50</td>
                        <td>Almacén A</td>
                        <td class="acciones">
                            <button class="btn-editar">Editar</button>
                            <button class="btn-eliminar">Eliminar</button>
                        </td>
                    </tr>
                    <tr class="stock-bajo">
                        <td>FR-AIR-003</td>
                        <td>Filtro de Aire Primario</td>
                        <td>PATITO2</td>
                        <td>8</td>
                        <td>Almacén B</td>
                        <td class="acciones">
                            <button class="btn-editar">Editar</button>
                            <button class="btn-eliminar">Eliminar</button>
                        </td>
                    </tr>
                    <tr>
                        <td>FR-COMB-002</td>
                        <td>Filtro de Combustible</td>
                        <td>PATITO3</td>
                        <td>120</td>
                        <td>Almacén A</td>
                        <td class="acciones">
                            <button class="btn-editar">Editar</button>
                            <button class="btn-eliminar">Eliminar</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Modal de carga masiva -->
        <div id="modal-fondo" style="display:none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index:1000;">
            <div class="contenedor-formulario" id="modal-carga-masiva" style="display:block; max-width:600px; margin: 50px auto; position: relative;">
                <div class="modulo-titulo">
                    <h2>Carga Masiva de Inventario</h2>
                </div>

                <form id="form-carga-masiva">
                    <!-- Selección tipo inventario -->
                    <div class="campo-form">
                        <label>Selecciona el tipo de inventario:</label>
                        <select id="tipo-inventario-masivo" required>
                            <option value="filtro">Filtro</option>
                            <option value="lubricante">Lubricante</option>
                        </select>
                    </div>

                    <!-- Descargar plantilla -->
                    <div class="acciones-form">
                        <button type="button" class="btn-primario" id="btn-descargar-plantilla">Descargar Plantilla</button>
                    </div>

                    <!-- Subir archivo Excel -->
                    <div class="campo-form">
                        <label>Subir archivo de Inventario (Excel)</label>
                        <input type="file" id="upload-excel-masivo" accept=".xlsx, .xls" />
                    </div>

                    <!-- Guardar y cancelar -->
                    <div class="acciones-form">
                        <button type="submit" class="btn-primario">Guardar y Continuar</button>
                        <button type="button" class="btn-eliminar" id="btn-cancelar-masivo">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Formulario de selección de tipo de inventario (existente) -->
        <div class="contenedor-formulario" id="formulario-seleccion" style="display: none;">
            <div class="modulo-titulo">
                <h2>Selecciona Tipo de Inventario</h2>
            </div>
            <form>
                <div class="campo-form">
                    <label>Selecciona el tipo de inventario:</label>
                    <select id="tipo-inventario" required>
                        <option value="filtro">Filtro</option>
                        <option value="lubricante">Lubricante</option>
                    </select>
                </div>
                <div class="acciones-form">
                    <button type="button" id="btn-confirmar-tipo" class="btn-primario">Confirmar</button>
                    <button type="button" class="btn-eliminar" id="btn-cancelar">Cancelar</button>
                </div>
            </form>
        </div>

        <!-- Formulario de registro de filtro o lubricante (existente) -->
        <div class="contenedor-formulario" id="formulario-registro" style="display: none;">
            <div class="modulo-titulo">
                <h2 id="titulo-formulario">Registrar Filtro</h2>
            </div>

            <form class="form-registro" id="form-inventario">
                <!-- ID -->
                <div class="campo-form">
                    <label>ID del Inventario</label>
                    <input type="text" id="inventario-id" placeholder="Ej. 1 o 2" required>
                </div>

                <!-- Número de serie o lote -->
                <div class="campo-form" id="campo-numero-serie">
                    <label>Número de Serie</label>
                    <input type="text" id="numero-serie" placeholder="Ej. FR-ACE-100" required>
                </div>

                <div class="campo-form" id="campo-numero-lote" style="display: none;">
                    <label>Número de Lote</label>
                    <input type="text" id="numero-lote" placeholder="Ej. LUB-001" required>
                </div>

                <!-- Ubicación -->
                <div class="campo-form">
                    <label>Ubicación</label>
                    <input type="text" id="ubicacion" placeholder="Ej. Taller Tenango" required>
                </div>

                <!-- Cantidad -->
                <div class="campo-form">
                    <label>Cantidad</label>
                    <input type="number" id="cantidad" placeholder="Ej. 10" required>
                </div>

                <!-- Botones de acción -->
                <div class="acciones-form">
                    <button type="submit" class="btn-primario">Guardar Inventario</button>
                    <button type="button" class="btn-eliminar" id="btn-cancelar-formulario">Cancelar</button>
                </div>
            </form>

            <!-- Subir archivo -->
            <div class="campo-form">
                <label>Subir archivo de Inventario (Excel)</label>
                <input type="file" id="upload-excel" accept=".xlsx, .xls" />
            </div>

            <!-- Botón para descargar Excel -->
            <div class="acciones-form" id="acciones-descarga">
                <button type="button" class="btn-primario" id="btn-descargar-excel">Descargar Excel</button>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function(){

            // --- Modal de carga masiva ---
            const botonAgregarInventario = document.getElementById("btn-agregar-inventario");
            const modalFondo = document.getElementById("modal-fondo");
            const botonCancelarMasivo = document.getElementById("btn-cancelar-masivo");
            const btnDescargarPlantilla = document.getElementById("btn-descargar-plantilla");
            const tipoInventarioMasivo = document.getElementById("tipo-inventario-masivo");
            const uploadExcelMasivo = document.getElementById("upload-excel-masivo");
            const formCargaMasiva = document.getElementById("form-carga-masiva");

            // Abrir modal
            botonAgregarInventario.addEventListener("click", function() {
                modalFondo.style.display = "block";
            });

            // Cerrar modal
            botonCancelarMasivo.addEventListener("click", function() {
                modalFondo.style.display = "none";
                formCargaMasiva.reset();
            });

            // Descargar plantilla según tipo
            btnDescargarPlantilla.addEventListener("click", function() {
                const tipo = tipoInventarioMasivo.value;
                let data = [];

                if(tipo === "filtro") {
                    data = [
                        ['ID', 'Número de Serie', 'Ubicación'],
                        ['FR-ACE-001', 'FR-ACE-100', 'Almacén A']
                    ];
                } else {
                    data = [
                        ['ID', 'Número de Lote', 'Ubicación'],
                        ['LUB-001', 'LUB-001-A', 'Almacén A']
                    ];
                }

                const ws = XLSX.utils.aoa_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Inventario');
                XLSX.writeFile(wb, `${tipo}_Inventario.xlsx`);
            });

            // Subir archivo Excel
            uploadExcelMasivo.addEventListener("change", function(event){
                const file = event.target.files[0];
                if(file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xls'))) {
                    const reader = new FileReader();
                    reader.onload = function(e){
                        const data = e.target.result;
                        const workbook = XLSX.read(data, { type: 'binary' });
                        const sheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(sheet);
                        console.log(jsonData);
                        alert('Archivo subido y procesado.');
                    };
                    reader.readAsBinaryString(file);
                } else {
                    alert('Por favor, sube un archivo Excel válido (.xlsx).');
                }
            });

            // Guardar y cerrar modal
            formCargaMasiva.addEventListener("submit", function(e){
                e.preventDefault();
                alert('Inventario cargado correctamente.');
                modalFondo.style.display = "none";
                formCargaMasiva.reset();
            });

        });
    </script>
</body>
</html>
